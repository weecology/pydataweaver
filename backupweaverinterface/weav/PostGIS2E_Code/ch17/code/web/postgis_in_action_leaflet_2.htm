<!doctype html>
<html lang="en"><head>
 <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
  <script src="//cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
  <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
  <style> #map {height: 600px;width: 100%;}</style>
	</head>
	<body>
		 <div id="map"></div>
		 <script type="text/javascript">
		     
		     var l1 = L.tileLayer(
                 'http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                     attribution: 'Map data © OpenStreetMap contributors',
                     maxZoom: 18
                 });
		     var map = L.map('map', { layers: [l1] })
               .setView([42.3581, -71.0636], 15);
		     
		     var l2 = L.tileLayer.wms("Map.ashx", {
		         layers: 'major_roads,openspace',
		         format: 'image/png',
		         transparent: true,
		         version: '1.3.0',
		         attribution: "MassGIS data"
		     });

		     var baseMaps = { "OpenStreetMap": l1 }
		     var overlayMaps = { "Open Space / Major Roads": l2 }
		     L.control.layers(baseMaps, overlayMaps, { collapsed: false }).addTo(map);

		     var popup = L.popup();
		     var lgeojson; //geojson layer
		     function onMapClick(e) {
		         var geoJsonLoc = '{"type":"Point","coordinates":[' + e.latlng.lng 
                   + ',' + e.latlng.lat + ']}'
		         $.getJSON("get_features.php", { 'geom': geoJsonLoc,
		             'table': 'ch17.ma_openspace', 
                     'props': 'site_name, gis_acres'
		         })
                    .done(function (data) {
                        var popupContent = ''
                        if (lgeojson != null){
                          map.removeLayer(lgeojson);
                        }
                        lgeojson = L.geoJson(data, {
                            onEachFeature: function (feature, layer) {
                                popupContent += '<b>Site:</b> ' 
                                  + feature.properties.site_name
                                  + '<br /><b>Acres:</b> ' 
                                  + feature.properties.gis_acres
                            }, style: { "color": "blue", "weight":10 }
                        });
                        popup.setLatLng(e.latlng)
                         .setContent(popupContent).openOn(map);

                        lgeojson.addTo(map);
                    });
		     }

		     map.on('click', onMapClick);
		 </script>
	</body>
</html>